# Anti-pattern detection — Security domain
#
# Detects credentials, secrets, and insecure configurations in
# AI-generated output.  Each pattern entry is evaluated independently;
# when any search_pattern matches and no safe_pattern matches, the
# warning_message is surfaced to the user for review.

domain: security
description: Credentials, secrets, and insecure configuration detection

patterns:
  - search_patterns:
      - "connection_string"
      - "connectionstring"
      - "access_key"
      - "accesskey"
      - "account_key"
      - "accountkey"
      - "shared_access_key"
      - "client_secret"
      - "password ="
      - "password=\""
      - "password='"
    safe_patterns:
      - "applicationinsights_connection_string"
      - "appinsights_connection_string"
      - "application_insights_connection_string"
      - "appinsights_connectionstring"
    warning_message: "Possible credential/secret in output — use managed identity instead of connection strings or keys."

  - search_patterns:
      - "admin_enabled = true"
      - "admin_username"
      - "admin_password"
    safe_patterns: []
    warning_message: "Admin credentials detected — use managed identity or RBAC-based authentication instead."

  - search_patterns:
      - "hardcoded"
      - "hard-coded"
      - "hard coded"
    safe_patterns:
      - "do not hardcode"
      - "avoid hardcod"
      - "never hardcode"
      - "don't hardcode"
    warning_message: "Possible hard-coded value detected — externalize secrets to Key Vault or use managed identity."

  - search_patterns:
      - "disable_tde"
      - "transparent_data_encryption = false"
      - "encryption_at_rest = false"
    safe_patterns: []
    warning_message: "Encryption at rest appears disabled — leave default encryption enabled on all data services."

  - search_patterns:
      - "output \"cosmos_account_primary_key\""
      - "output \"cosmos_primary_key\""
      - "output \"cosmos_connection_strings\""
      - "output \"primary_key\""
      - "output \"primary_connection_string\""
      - "output \"secondary_key\""
      - "output \"storage_account_key\""
      - "output \"storage_primary_key\""
      - "output \"sql_admin_password\""
    safe_patterns:
      - "deprecated"
      - "do not use"
    warning_message: "Sensitive value exposed as Terraform output — remove this output entirely. Use managed identity instead of keys."

  - search_patterns:
      - "DO NOT USE - use managed identity"
      - "DEPRECATED: Use managed identity"
      - "WARNING: Do not use"
    safe_patterns: []
    warning_message: "Output marked as 'do not use' should be removed entirely, not left with a warning. Omit sensitive outputs."
